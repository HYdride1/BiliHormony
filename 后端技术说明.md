## 后端技术说明

### 主要文件结构

```
C:.
│  .env // 环境变量 
│  main.py // 主要逻辑
│  myjson
│  README.md
│  test.json
│  test_main.py
│
├─.idea
│
├─app
│  │  crud.py // 增删查改
│  │  database.py // 数据库加载
│  │  models.py // 数据库表
│  │  schemas.py // 返回与接受的结构定义
│  │  security.py //安全相关函数
│  └─  __init__.py
│
└─__pycache__


```

### 重要模块

`main.py`：实现与前端的通信接口，以及数据库的初始数据插入

`crud.py` ：后端的主要实现逻辑

`schemas.py`：与前端通信的类的定义

### 数据库说明

##### 两张表

1. users

   | u_id     | account  | password | like   | coin     |
   | -------- | -------- | -------- | ------ | -------- |
   | Integer  | String   | String   | String | Integer  |
   | 主键     | 唯一     |          |        |          |
   | NOT NULL | NOT NULL | NOT NULL |        | NOT NULL |

   

1. videos

   | bv       | name   | type     | like     | coin     | url      |
   | -------- | ------ | -------- | -------- | -------- | -------- |
   | Integer  | String | Integer  | Interger | Interger | String   |
   | 主键     |        |          |          |          |          |
   | NOT NULL | NOT    | NOT NULL | NOT NULL | NOT NULL | NOT NULL |

### 重要技术手段

使用 **SQLAlchemy**结合连接池来高效地管理数据库连接。

结合 **MySQL** 使用异步数据库库（例如 `asyncmy` 或 `databases`）可以避免阻塞，使服务器能处理更多的请求。使用 `async`/`await` 进行数据库操作.

利用 FastAPI 的依赖注入机制自动获取数据库连接或会话。

使用 **Depends** 创建数据库连接的依赖注入方法。

## 前后端连接说明

### user类接口说明

请求方式均为post

1. 注册：/user/signup
   前端发送的json格式为

   ```
   {
   "account" :  str
   "password": str
   }
   ```

   接受示例:

   ```json
   {
     "account": "string",
     "password": "string",
     "u_id": 0,
     "like": "",
     "coin": 100
   }
   ```

2. 登录：/user/login
   前端发送的json格式为

   ```
   {
   "account" :  str
   "password": str
   }
   ```

3. 我的界面中的数据：/user/detail
   前端发送的json格式为

   ```
   {
   "account" :  str
   }
   ```

   接受示例:

   ```json
   {
     "like": "",
     "coin": 0
   }
   ```

### video类接口说明

请求方式均为post

1. 根据bv号返回视频/video/bv

   请求示例:

   ```json
   {
     "bv": 0
   }
   ```

   接受示例:

   ```json
   {
     "bv": 0,
     "type": 0,
     "name": "string",
     "like": 0,
     "coin": 0,
     "url": "string",
     "cover_url": "string"
   }
   ```

2. 返回热门视频,/video/hot

   返回video的List,示例:

   ```json
   [
     {
       "bv": 0,
       "type": 0,
       "name": "string",
       "like": 0,
       "coin": 0,
       "url": "string",
       "cover_url": "string"
     }
   ]
   ```

3. 返回主页视频,/video/homepage

   返回示例同2

4. 返回一个类型的视频,/video/cate

   接受示例:

   ```json
   {
     "type": "string"
   }
   ```

   返回示例同2

5. 根据bv号查询视频赞数,/video/like

   请求示例:

   ```json
   {
     "bv": 0
   }
   ```

   返回示例:

   ```json
   {
     "like": 0
   }
   ```

6. 根据bv号查询视频币数,/video/coin

   请求示例:

   ```json
   {
     "bv": 0
   }
   ```

   返回示例:

   ```json
   {
     "coin": 0
   }
   ```

7. 根据name来搜索相关的视频,/video/name

   请求示例:

   ```json
   {
     "name": "string"
   }
   ```

   返回示例同2

8. 根据账号和视频处理投币操作,video/getcoin

   请求示例:

   ```json
   {
     "account": "string",
     "bv": 0
   }
   ```

   返回示例:

   ```json
   {
     "message": "string",
     "user": {
       "account": "string",
       "password": "string",
       "u_id": 0,
       "like": "",
       "coin": 100
     },
     "video": {
       "bv": 0,
       "type": 0,
       "name": "string",
       "like": 0,
       "coin": 0,
       "url": "string",
       "cover_url": "string"
     }
   }
   ```

9. 根据bv号处理点赞操作,/video/getlike

   请求示例:

   ```json
   {
     "bv": 0
   }
   ```

   返回示例:

   ```json
   {
     "bv": 0,
     "type": 0,
     "name": "string",
     "like": 0,
     "coin": 0,
     "url": "string",
     "cover_url": "string"
   }
   ```

